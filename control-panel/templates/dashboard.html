{% extends 'base.html' %}

{% block title %}Dashboard - WebOps{% endblock %}
{% block header_title %}Dashboard{% endblock %}

{% block content %}
<div class="webops-page-header">
    <div>
        <h2 class="webops-page-title">Dashboard</h2>
        <p class="webops-text-muted">Overview of your WebOps infrastructure</p>
    </div>
    <a href="{% url 'deployments:deployment_create' %}" class="webops-btn webops-btn-primary">
        <span class="material-icons">add</span>
        New Deployment
    </a>
</div>

<!-- Main Stats Overview -->
<div class="webops-stats-grid">
    <div class="webops-stat-card">
        <div class="webops-stat-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.62947 4.96287C10.1293 3.20697 12.5539 3.20697 13.0537 4.96287L14.4429 9.9298C14.6156 10.5183 15.1189 10.9601 15.7259 11.0334L20.5732 11.6631C22.2885 11.8795 22.7288 14.102 21.2828 15.021L17.5312 17.4454C17.0602 17.7505 16.8322 18.3475 16.9453 18.922L17.945 23.6938C18.3156 25.4025 16.4251 26.5411 14.9739 25.647L10.8354 23.018C10.334 22.6936 9.68883 22.6936 9.18742 23.018L5.04894 25.647C3.59772 26.5411 1.70724 25.4025 2.07781 23.6938L3.07755 18.922C3.19062 18.3475 2.96263 17.7505 2.49161 17.4454L-1.26004 15.021C-2.70603 14.102 -2.26573 11.8795 -0.550474 11.6631L4.29681 11.0334C4.90382 10.9601 5.40713 10.5183 5.57983 9.9298L6.96907 4.96287H9.62947Z" fill="currentColor"/>
            </svg>
        </div>
        <div class="webops-stat-value">{{ deployment_stats.total }}</div>
        <div class="webops-stat-label">Total Deployments</div>
    </div>

    <div class="webops-stat-card">
        <div class="webops-stat-icon" style="background: rgba(0, 255, 136, 0.1); color: var(--webops-color-success);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="currentColor"/>
            </svg>
        </div>
        <div class="webops-stat-value">{{ deployment_stats.running }}</div>
        <div class="webops-stat-label">Running</div>
    </div>

    <div class="webops-stat-card">
        <div class="webops-stat-icon" style="background: rgba(255, 170, 0, 0.1); color: var(--webops-color-warning);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z" fill="currentColor"/>
            </svg>
        </div>
        <div class="webops-stat-value">{{ deployment_stats.pending }}</div>
        <div class="webops-stat-label">Building</div>
    </div>

    <div class="webops-stat-card">
        <div class="webops-stat-icon" style="background: rgba(255, 68, 68, 0.1); color: var(--webops-color-error);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="currentColor"/>
            </svg>
        </div>
        <div class="webops-stat-value">{{ deployment_stats.failed }}</div>
        <div class="webops-stat-label">Failed</div>
    </div>

    <div class="webops-stat-card">
        <div class="webops-stat-icon" style="background: rgba(168, 201, 187, 0.1); color: var(--webops-color-text-secondary);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 16h2V8H9v8zm3-14C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm1-4h2V8h-2v8z" fill="currentColor"/>
            </svg>
        </div>
        <div class="webops-stat-value">{{ deployment_stats.stopped }}</div>
        <div class="webops-stat-label">Stopped</div>
    </div>
</div>

<!-- Secondary Stats Cards -->
<div class="webops-grid webops-grid-3" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
    <div class="webops-card">
        <div class="webops-card-header">
            <h3 class="webops-h3">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                    <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" fill="currentColor"/>
                </svg>
                Databases
            </h3>
        </div>
        <div class="webops-card-body">
            <div style="display: flex; justify-content: space-around; margin-bottom: 1rem;">
                <div style="text-align: center;">
                    <div class="webops-stat-value" style="font-size: 1.5rem;">{{ database_stats.total }}</div>
                    <div class="webops-stat-label">TOTAL</div>
                </div>
                <div style="text-align: center;">
                    <div class="webops-stat-value" style="font-size: 1.5rem;">{{ database_stats.with_deployment }}</div>
                    <div class="webops-stat-label">ATTACHED</div>
                </div>
                <div style="text-align: center;">
                    <div class="webops-stat-value" style="font-size: 1.5rem;">{{ database_stats.standalone }}</div>
                    <div class="webops-stat-label">STANDALONE</div>
                </div>
            </div>
            <a href="{% url 'database_list' %}" class="webops-btn webops-btn-sm webops-btn-primary webops-w-full">
                View All Databases
            </a>
        </div>
    </div>

    <div class="webops-card">
        <div class="webops-card-header">
            <h3 class="webops-h3">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                    <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="currentColor"/>
                </svg>
                API Tokens
            </h3>
        </div>
        <div class="webops-card-body">
            <div style="display: flex; justify-content: space-around; margin-bottom: 1rem;">
                <div style="text-align: center;">
                    <div class="webops-stat-value" style="font-size: 1.5rem;">{{ token_stats.total }}</div>
                    <div class="webops-stat-label">TOTAL</div>
                </div>
                <div style="text-align: center;">
                    <div class="webops-stat-value" style="font-size: 1.5rem;">{{ token_stats.active }}</div>
                    <div class="webops-stat-label">ACTIVE</div>
                </div>
                <div style="text-align: center;">
                    <div class="webops-stat-value" style="font-size: 1.5rem;">{{ token_stats.expired }}</div>
                    <div class="webops-stat-label">EXPIRED</div>
                </div>
            </div>
            <a href="{% url 'token_list' %}" class="webops-btn webops-btn-sm webops-btn-primary webops-w-full">
                Manage Tokens
            </a>
        </div>
    </div>

    <div class="webops-card">
        <div class="webops-card-header">
            <h3 class="webops-h3">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                    <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 4.3-4.29L22 12V6z" fill="currentColor"/>
                </svg>
                Activity
            </h3>
        </div>
        <div class="webops-card-body">
            <div style="text-align: center; padding: 1rem; background: rgba(0, 255, 136, 0.1); border-radius: var(--webops-radius-md); margin-bottom: 1rem;">
                <div class="webops-stat-value" style="font-size: 2rem;">{{ recent_deployments }}</div>
                <div class="webops-text-secondary" style="font-size: 0.875rem;">deployments in last 7 days</div>
            </div>
            <a href="{% url 'deployments:deployment_list' %}" class="webops-btn webops-btn-sm webops-btn-primary webops-w-full">
                View All Deployments
            </a>
        </div>
    </div>
</div>

<!-- Project Types -->
{% if project_types %}
<div class="webops-card">
    <div class="webops-card-header">
        <h3 class="webops-h3">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                    <path d="M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z" fill="currentColor"/>
                </svg>
                Project Types
            </h3>
    </div>
    <div class="webops-card-body">
        <div class="webops-grid webops-grid-3">
            {% for pt in project_types %}
            <div class="webops-flex webops-items-center webops-gap-md webops-p-md" style="background: rgba(0, 255, 136, 0.05); border-radius: var(--webops-radius-md); border: 1px solid rgba(0, 255, 136, 0.1);">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="webops-text-primary">
                    {% if pt.project_type == 'django' %}
                        <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-3.09 3.08L4.09 19l4.24-4.24 2.1 2.1c.74.74 1.62 1.16 2.54 1.54l-1.89 2.49 1.39 1.39L19 13l-1.39-1.39L16.89 15.07z" fill="currentColor"/>
                    {% elif pt.project_type == 'nodejs' %}
                        <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" fill="currentColor"/>
                    {% else %}
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H9v-4h6v4zm5-6H4V8h16v4z" fill="currentColor"/>
                    {% endif %}
                </svg>
                <div>
                    <div class="webops-font-semibold webops-text-primary">{{ pt.project_type|title }}</div>
                    <div class="webops-text-sm webops-text-secondary">{{ pt.count }} deployment{{ pt.count|pluralize }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- Recent Deployments -->
<div class="webops-card">
    <div class="webops-card-header">
        <h3 class="webops-h3">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" fill="currentColor"/>
                </svg>
                Recent Deployments
            </h3>
        <a href="{% url 'deployments:deployment_list' %}" class="webops-btn webops-btn-sm webops-btn-secondary">View All</a>
    </div>

    {% if deployments %}
    <div class="webops-table-responsive">
        <table class="webops-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Type</th>
                    <th>Domain</th>
                    <th>Port</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for deployment in deployments %}
                <tr>
                    <td data-label="Name"><strong>{{ deployment.name }}</strong></td>
                    <td data-label="Status">
                        {% if deployment.status == 'running' %}
                            <span class="webops-badge webops-badge-success">Running</span>
                        {% elif deployment.status == 'stopped' %}
                            <span class="webops-badge webops-badge-info">Stopped</span>
                        {% elif deployment.status == 'pending' %}
                            <span class="webops-badge webops-badge-warning">Building</span>
                        {% elif deployment.status == 'failed' %}
                            <span class="webops-badge webops-badge-danger">Failed</span>
                        {% else %}
                            <span class="webops-badge webops-badge-info">{{ deployment.get_status_display }}</span>
                        {% endif %}
                    </td>
                    <td data-label="Type">{{ deployment.get_project_type_display }}</td>
                    <td data-label="Domain">
                        {% if deployment.domain %}
                            <a href="http://{{ deployment.domain }}" target="_blank" class="webops-text-primary">
                                {{ deployment.domain }}
                            </a>
                        {% else %}
                            <span class="webops-text-muted">—</span>
                        {% endif %}
                    </td>
                    <td data-label="Port">
                        {% if deployment.port %}
                            <code class="webops-text-sm">:{{ deployment.port }}</code>
                        {% else %}
                            <span class="webops-text-muted">—</span>
                        {% endif %}
                    </td>
                    <td data-label="Created">{{ deployment.created_at|date:"M j, g:i A" }}</td>
                    <td data-label="Actions">
                        <a href="{% url 'deployments:deployment_detail' deployment.pk %}" class="webops-btn webops-btn-sm webops-btn-primary">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="webops-empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="webops-empty-state-icon" style="color: var(--webops-color-text-tertiary); opacity: 0.3;">
            <path d="M9.62947 4.96287C10.1293 3.20697 12.5539 3.20697 13.0537 4.96287L14.4429 9.9298C14.6156 10.5183 15.1189 10.9601 15.7259 11.0334L20.5732 11.6631C22.2885 11.8795 22.7288 14.102 21.2828 15.021L17.5312 17.4454C17.0602 17.7505 16.8322 18.3475 16.9453 18.922L17.945 23.6938C18.3156 25.4025 16.4251 26.5411 14.9739 25.647L10.8354 23.018C10.334 22.6936 9.68883 22.6936 9.18742 23.018L5.04894 25.647C3.59772 26.5411 1.70724 25.4025 2.07781 23.6938L3.07755 18.922C3.19062 18.3475 2.96263 17.7505 2.49161 17.4454L-1.26004 15.021C-2.70603 14.102 -2.26573 11.8795 -0.550474 11.6631L4.29681 11.0334C4.90382 10.9601 5.40713 10.5183 5.57983 9.9298L6.96907 4.96287H9.62947Z" fill="currentColor"/>
        </svg>
        <h3 class="webops-empty-state-title">No deployments yet</h3>
        <p class="webops-empty-state-description">Create your first deployment to get started with WebOps</p>
        <a href="{% url 'deployments:deployment_create' %}" class="webops-btn webops-btn-primary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle;">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/>
            </svg>
            Create Deployment
        </a>
    </div>
    {% endif %}
</div>

<!-- Quick Actions -->
<div class="webops-mt-xl">
    <h3 class="webops-h3 webops-mb-lg webops-flex webops-items-center webops-gap-sm">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z" fill="currentColor"/>
        </svg>
        Quick Actions
    </h3>
    <div class="webops-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
        <a href="{% url 'deployments:deployment_create' %}" class="webops-card" style="text-decoration: none; display: block;">
            <div class="webops-card-body webops-text-center">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="webops-text-primary webops-mb-sm">
                    <path d="M9.62947 4.96287C10.1293 3.20697 12.5539 3.20697 13.0537 4.96287L14.4429 9.9298C14.6156 10.5183 15.1189 10.9601 15.7259 11.0334L20.5732 11.6631C22.2885 11.8795 22.7288 14.102 21.2828 15.021L17.5312 17.4454C17.0602 17.7505 16.8322 18.3475 16.9453 18.922L17.945 23.6938C18.3156 25.4025 16.4251 26.5411 14.9739 25.647L10.8354 23.018C10.334 22.6936 9.68883 22.6936 9.18742 23.018L5.04894 25.647C3.59772 26.5411 1.70724 25.4025 2.07781 23.6938L3.07755 18.922C3.19062 18.3475 2.96263 17.7505 2.49161 17.4454L-1.26004 15.021C-2.70603 14.102 -2.26573 11.8795 -0.550474 11.6631L4.29681 11.0334C4.90382 10.9601 5.40713 10.5183 5.57983 9.9298L6.96907 4.96287H9.62947Z" fill="currentColor"/>
                </svg>
                <div class="webops-font-semibold webops-text-primary webops-mb-xs">New Deployment</div>
                <div class="webops-text-sm webops-text-secondary">Deploy a new application</div>
            </div>
        </a>

        <a href="{% url 'database_create' %}" class="webops-card" style="text-decoration: none; display: block;">
            <div class="webops-card-body webops-text-center">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="webops-text-primary webops-mb-sm">
                    <path d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z" fill="currentColor"/>
                </svg>
                <div class="webops-font-semibold webops-text-primary webops-mb-xs">Create Database</div>
                <div class="webops-text-sm webops-text-secondary">Set up PostgreSQL database</div>
            </div>
        </a>

        <a href="{% url 'token_create' %}" class="webops-card" style="text-decoration: none; display: block;">
            <div class="webops-card-body webops-text-center">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="webops-text-primary webops-mb-sm">
                    <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="currentColor"/>
                </svg>
                <div class="webops-font-semibold webops-text-primary webops-mb-xs">Generate Token</div>
                <div class="webops-text-sm webops-text-secondary">Create API token</div>
            </div>
        </a>

        <a href="/api/status/" class="webops-card" style="text-decoration: none; display: block;">
            <div class="webops-card-body webops-text-center">
                <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="webops-text-primary webops-mb-sm">
                    <path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z" fill="currentColor"/>
                </svg>
                <div class="webops-font-semibold webops-text-primary webops-mb-xs">API Docs</div>
                <div class="webops-text-sm webops-text-secondary">View documentation</div>
            </div>
        </a>
    </div>
</div>
{% endblock %}