{% extends "base.html" %}

{% block title %}Toast & Notifications Center Test{% endblock %}

{% block content %}
<div class="webops-container">
    <div class="webops-page-header">
        <h1 class="webops-page-title">Toast & Notifications Center Test</h1>
    </div>

    <div class="webops-card">
        <div class="webops-card-body">
            <h2 class="webops-h2">Basic Toast Examples</h2>
            <p class="webops-text-muted">Click the buttons below to test different toast notifications.</p>
            
            <div class="webops-actions" style="margin-bottom: var(--webops-space-3);">
                <button class="webops-btn webops-btn-success" onclick="showSuccessToast()">
                    <span class="material-icons">check_circle</span>
                    Success Toast
                </button>
                <button class="webops-btn webops-btn-danger" onclick="showErrorToast()">
                    <span class="material-icons">error</span>
                    Error Toast
                </button>
                <button class="webops-btn webops-btn-info" onclick="showInfoToast()">
                    <span class="material-icons">info</span>
                    Info Toast
                </button>
                <button class="webops-btn webops-btn-secondary" onclick="showWarningToast()">
                    <span class="material-icons">warning</span>
                    Warning Toast
                </button>
            </div>
        </div>
    </div>

    <div class="webops-card">
        <div class="webops-card-body">
            <h2 class="webops-h2">Advanced Toast Examples</h2>
            <p class="webops-text-muted">Test advanced features like custom titles, actions, and duration.</p>
            
            <div class="webops-actions" style="margin-bottom: var(--webops-space-3);">
                <button class="webops-btn webops-btn-primary" onclick="showAdvancedToast()">
                    <span class="material-icons">notifications</span>
                    Advanced Toast
                </button>
                <button class="webops-btn webops-btn-primary" onclick="showStickyToast()">
                    <span class="material-icons">push_pin</span>
                    Sticky Toast
                </button>
                <button class="webops-btn webops-btn-primary" onclick="showActionToast()">
                    <span class="material-icons">touch_app</span>
                    Toast with Actions
                </button>
                <button class="webops-btn webops-btn-danger" onclick="hideAllToasts()">
                    <span class="material-icons">clear_all</span>
                    Hide All
                </button>
            </div>
        </div>
    </div>

    <div class="webops-card">
        <div class="webops-card-body">
            <h2 class="webops-h2">Alert to Toast Conversion</h2>
            <p class="webops-text-muted">These traditional alerts will be automatically converted to toasts.</p>
            
            <div class="webops-alert webops-alert-success" role="alert">
                <span class="material-icons webops-alert__icon">check_circle</span>
                <div class="webops-alert__content">
                    <strong>Success!</strong> This is a traditional success alert that will be converted to a toast.
                </div>
            </div>
            
            <div class="webops-alert webops-alert-error" role="alert">
                <span class="material-icons webops-alert__icon">error</span>
                <div class="webops-alert__content">
                    <strong>Error!</strong> This is a traditional error alert that will be converted to a toast.
                </div>
            </div>
            
            <div class="webops-actions" style="margin-top: var(--webops-space-3);">
                <button class="webops-btn webops-btn-secondary" onclick="addNewAlert()">
                    <span class="material-icons">add</span>
                    Add New Alert
                </button>
            </div>
        </div>
    </div>

    <div class="webops-card">
        <div class="webops-card-body">
            <h2 class="webops-h2">Django Messages Integration</h2>
            <p class="webops-text-muted">Test how Django messages are converted to toasts.</p>
            
            <form method="post" action="{% url 'test-toast-messages' %}">
                {% csrf_token %}
                <div class="webops-form-group">
                    <label class="webops-label">Message Type</label>
                    <select name="message_type" class="webops-select">
                        <option value="success">Success</option>
                        <option value="error">Error</option>
                        <option value="warning">Warning</option>
                        <option value="info">Info</option>
                    </select>
                </div>
                
                <div class="webops-form-group">
                    <label class="webops-label">Message</label>
                    <input type="text" name="message" class="webops-input" value="This is a test message from Django" required>
                </div>
                
                <button type="submit" class="webops-btn webops-btn-primary">
                    <span class="material-icons">send</span>
                    Send Message
                </button>
            </form>
        </div>
    </div>

    <div class="webops-card">
        <div class="webops-card-body">
            <h2 class="webops-h2">Notifications Center Test</h2>
            <p class="webops-text-muted">Test the notifications center functionality.</p>
            
            <div class="webops-actions" style="margin-bottom: var(--webops-space-3);">
                <button class="webops-btn webops-btn-primary" onclick="addNotificationToCenter()">
                    <span class="material-icons">add</span>
                    Add Random Notification
                </button>
                <button class="webops-btn webops-btn-secondary" onclick="openNotificationsCenter()">
                    <span class="material-icons">notifications</span>
                    Open Notifications Center
                </button>
                <button class="webops-btn webops-btn-secondary" onclick="markAllAsRead()">
                    <span class="material-icons">done_all</span>
                    Mark All as Read
                </button>
                <button class="webops-btn webops-btn-danger" onclick="clearAllNotifications()">
                    <span class="material-icons">clear_all</span>
                    Clear All
                </button>
            </div>
            
            <div class="webops-alert webops-alert-info" role="alert">
                <span class="material-icons">info</span>
                <div class="webops-alert__content">
                    <strong>Tip:</strong> Click the notifications button in the header to open the notifications center. Notifications are automatically saved to localStorage and will persist across page refreshes.
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showSuccessToast() {
    if (window.WebOpsToast) {
        window.WebOpsToast.success('Operation completed successfully!');
    } else {
        alert('Toast system not loaded yet');
    }
}

function showErrorToast() {
    if (window.WebOpsToast) {
        window.WebOpsToast.error('An error occurred while processing your request.');
    } else {
        alert('Toast system not loaded yet');
    }
}

function showInfoToast() {
    if (window.WebOpsToast) {
        window.WebOpsToast.info('Here is some useful information for you.');
    } else {
        alert('Toast system not loaded yet');
    }
}

function showWarningToast() {
    if (window.WebOpsToast) {
        window.WebOpsToast.warning('Please review your input before proceeding.');
    } else {
        alert('Toast system not loaded yet');
    }
}

function showAdvancedToast() {
    if (window.WebOpsToast) {
        window.WebOpsToast.show({
            title: 'Advanced Notification',
            message: 'This toast has a custom title, icon, and will stay visible for 10 seconds.',
            type: 'info',
            duration: 10000,
            onClick: (id) => {
                console.log('Toast clicked:', id);
                if (window.WebOpsToast) {
                    window.WebOpsToast.info('You clicked the toast! ID: ' + id);
                }
            }
        });
    } else {
        alert('Toast system not loaded yet');
    }
}

function showStickyToast() {
    if (window.WebOpsToast) {
        const id = window.WebOpsToast.show({
            title: 'Sticky Notification',
            message: 'This toast will not auto-dismiss. You must close it manually.',
            type: 'warning',
            duration: 0, // 0 means sticky
            onShow: (id) => {
                console.log('Sticky toast shown:', id);
            },
            onHide: (id) => {
                console.log('Sticky toast hidden:', id);
            }
        });
        
        console.log('Sticky toast ID:', id);
    } else {
        alert('Toast system not loaded yet');
    }
}

function showActionToast() {
    if (window.WebOpsToast) {
        window.WebOpsToast.show({
            title: 'Action Required',
            message: 'Please choose an action below:',
            type: 'info',
            duration: 0, // Sticky until action is taken
            actions: [
                {
                    text: 'Accept',
                    handler: (id) => {
                        if (window.WebOpsToast) {
                            window.WebOpsToast.hide(id);
                            window.WebOpsToast.success('Action accepted!');
                        }
                    }
                },
                {
                    text: 'Decline',
                    handler: (id) => {
                        if (window.WebOpsToast) {
                            window.WebOpsToast.hide(id);
                            window.WebOpsToast.warning('Action declined.');
                        }
                    }
                }
            ]
        });
    } else {
        alert('Toast system not loaded yet');
    }
}

function hideAllToasts() {
    if (window.WebOpsToast) {
        window.WebOpsToast.hideAll();
    } else {
        alert('Toast system not loaded yet');
    }
}

function addNewAlert() {
    const container = document.querySelector('.webops-container');
    const alertsContainer = container.querySelector('.webops-card:nth-child(3) .webops-card-body');
    
    const alertTypes = ['success', 'error', 'warning', 'info'];
    const randomType = alertTypes[Math.floor(Math.random() * alertTypes.length)];
    
    const alert = document.createElement('div');
    alert.className = `webops-alert webops-alert-${randomType}`;
    alert.setAttribute('role', 'alert');
    alert.innerHTML = `
        <span class="material-icons webops-alert__icon">${getIconForType(randomType)}</span>
        <div class="webops-alert__content">
            <strong>${randomType.charAt(0).toUpperCase() + randomType.slice(1)}!</strong>
            This is a dynamically added alert that should be converted to a toast.
        </div>
    `;
    
    alertsContainer.appendChild(alert);
    
    // The toast system should automatically detect and convert this new alert
}

function getIconForType(type) {
    const icons = {
        success: 'check_circle',
        error: 'error',
        warning: 'warning',
        info: 'info'
    };
    return icons[type] || 'info';
}

// Notifications Center Test Functions
function addNotificationToCenter() {
    if (window.WebOpsNotificationsCenter) {
        const types = ['success', 'error', 'warning', 'info'];
        const type = types[Math.floor(Math.random() * types.length)];
        
        const notificationId = window.WebOpsNotificationsCenter.addNotification({
            title: `Test ${type.charAt(0).toUpperCase() + type.slice(1)} Notification`,
            message: `This is a test ${type} notification added to the notifications center. Click the notifications button to view it.`,
            type: type,
            read: false,
            actions: [
                {
                    id: 'action1',
                    text: 'Action 1',
                    handler: (id) => {
                        if (window.WebOpsToast) {
                            window.WebOpsToast.info(`Action 1 triggered for notification ${id}`);
                        }
                    }
                },
                {
                    id: 'action2',
                    text: 'Action 2',
                    handler: (id) => {
                        if (window.WebOpsToast) {
                            window.WebOpsToast.info(`Action 2 triggered for notification ${id}`);
                        }
                    }
                }
            ]
        });
        
        if (window.WebOpsToast) {
            window.WebOpsToast.success(`Added ${type} notification to center`);
        }
        
        return notificationId;
    } else {
        alert('Notifications center not loaded yet');
    }
}

function markAllAsRead() {
    if (window.WebOpsNotificationsCenter) {
        window.WebOpsNotificationsCenter.markAllAsRead();
        if (window.WebOpsToast) {
            window.WebOpsToast.info('All notifications marked as read');
        }
    } else {
        alert('Notifications center not loaded yet');
    }
}

function clearAllNotifications() {
    if (window.WebOpsNotificationsCenter) {
        window.WebOpsNotificationsCenter.clearAll();
        if (window.WebOpsToast) {
            window.WebOpsToast.info('All notifications cleared');
        }
    } else {
        alert('Notifications center not loaded yet');
    }
}

function openNotificationsCenter() {
    if (window.WebOpsNotificationsCenter) {
        window.WebOpsNotificationsCenter.open();
    } else {
        alert('Notifications center not loaded yet');
    }
}

// Show a welcome toast when the page loads
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        if (window.WebOpsToast) {
            window.WebOpsToast.show({
                title: 'Toast System Ready',
                message: 'The toast notification system has been loaded successfully. Try the examples above!',
                type: 'success',
                duration: 8000
            });
        }
        
        // Add a notification to the notifications center
        if (window.WebOpsNotificationsCenter) {
            window.WebOpsNotificationsCenter.addNotification({
                title: 'Test Page Loaded',
                message: 'Welcome to the toast and notifications center test page. Click the notifications button to view all notifications.',
                type: 'info',
                read: false
            });
        }
    }, 1000);
});
</script>
{% endblock %}