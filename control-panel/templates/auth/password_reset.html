{% extends 'auth/auth_base.html' %}

{% block title %}Reset Password - WebOps{% endblock %}
{% block page_title %}Reset Password{% endblock %}
{% block card_max_width %}450px{% endblock %}

{% block content %}
<div class="auth-alert auth-alert-info" role="alert">
    <span class="material-icons">info</span>
    <span>Enter your email address and we'll send you instructions to reset your password.</span>
</div>

<form method="post" id="resetForm" novalidate>
    {% csrf_token %}

    <div class="auth-form-group">
        <label for="{{ form.email.id_for_label }}" class="webops-label">Email Address</label>
        <div class="auth-input-wrapper">
            {{ form.email }}
            <span class="auth-input-icon material-icons" id="email-icon" aria-hidden="true"></span>
        </div>
        <div class="auth-feedback" id="email-feedback" role="alert"></div>
        {% if form.email.errors %}
            <div class="auth-feedback show error">
                <span class="material-icons">error</span>
                <span>{{ form.email.errors|first }}</span>
            </div>
        {% endif %}
    </div>

    <button type="submit" class="webops-btn webops-btn-primary webops-w-full webops-mb-md" id="submitBtn">
        Send Reset Link
    </button>

    <div class="webops-text-center webops-text-secondary">
        <a href="{% url 'login' %}" class="webops-text-primary" style="text-decoration: none; display: inline-flex; align-items: center; gap: var(--webops-space-1);">
            <span class="material-icons" style="font-size: 18px;">arrow_back</span>
            Back to Login
        </a>
    </div>
</form>
{% endblock %}

{% block extra_scripts %}
<script>
(function() {
    'use strict';

    const form = document.getElementById('resetForm');
    const emailInput = document.getElementById('{{ form.email.id_for_label }}');
    const submitBtn = document.getElementById('submitBtn');

    // Add placeholders and classes
    emailInput.placeholder = 'your.email@example.com';
    emailInput.className = 'auth-input';
    emailInput.type = 'email';
    emailInput.autocomplete = 'email';
    emailInput.setAttribute('aria-describedby', 'email-feedback');
    emailInput.autofocus = true;

    // Email validation
    function validateEmail() {
        const value = emailInput.value.trim();
        const feedback = document.getElementById('email-feedback');
        const icon = document.getElementById('email-icon');

        if (value === '') {
            emailInput.classList.remove('valid', 'invalid');
            icon.textContent = '';
            feedback.classList.remove('show');
            return false;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(value)) {
            emailInput.classList.remove('valid');
            emailInput.classList.add('invalid');
            icon.textContent = 'error';
            icon.classList.remove('success');
            icon.classList.add('error');
            feedback.innerHTML = '<span class="material-icons">error</span><span>Please enter a valid email address</span>';
            feedback.classList.add('show', 'error');
            feedback.classList.remove('success');
            return false;
        }

        emailInput.classList.remove('invalid');
        emailInput.classList.add('valid');
        icon.textContent = 'check_circle';
        icon.classList.remove('error');
        icon.classList.add('success');
        feedback.classList.remove('show');
        return true;
    }

    // Attach event listeners
    emailInput.addEventListener('input', validateEmail);
    emailInput.addEventListener('blur', validateEmail);

    // Form submission
    form.addEventListener('submit', function(e) {
        const emailValid = validateEmail();

        if (!emailValid) {
            e.preventDefault();
            emailInput.focus();
            return false;
        }

        // Add loading state
        submitBtn.classList.add('auth-btn-loading');
        submitBtn.textContent = 'Sending...';
    });
})();
</script>
{% endblock %}
