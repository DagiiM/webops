[Unit]
Description={{ app_name }} - {{ description|default("WebOps Deployment") }}
After=network.target {{ after_services|default("postgresql.service") }}
{% if wants_services %}Wants={{ wants_services|default("") }}{% endif %}

[Service]
Type={{ service_type|default("simple") }}
User={{ webops_user }}
Group={{ webops_user|default(webops_user) }}
WorkingDirectory={{ working_directory|default(repo_path) }}

# Environment
Environment="PATH={{ venv_path }}/bin:/usr/local/bin:/usr/bin:/bin"
Environment="PYTHONPATH={{ repo_path }}"
{% for key, value in env_vars.items() %}
Environment="{{ key }}={{ value }}"
{% endfor %}

# Command execution
{% if exec_start %}
ExecStart={{ exec_start }}
{% endif %}

# Restart policy
Restart={{ restart_policy|default("always") }}
RestartSec={{ restart_sec|default("5") }}

# Security
{% if security_enabled|default(true) %}
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths={{ repo_path }} {{ log_path }}
{% endif %}

[Install]
WantedBy=multi-user.target